<!DOCTYPE html>
<html lang="en" data-theme="cupcake">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zmply Helper - Professional Productivity Suite</title>

    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .ad-slot {
            background: #f1f5f9;
            border: 2px dashed #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
            font-weight: bold;
            font-size: 12px;
        }

        #editor-container {
            height: 350px;
            background: white;
            border-radius: 0 0 1rem 1rem;
        }

        .sticky-note {
            cursor: grab;
            transition: all 0.2s;
        }

        .column {
            min-height: 300px;
        }

        .placeholder-card {
            border: 2px dashed #cbd5e1;
            background: rgba(241, 245, 249, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            border-radius: 1.5rem;
            color: #94a3b8;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.1em;
            pointer-events: none;
        }
    </style>
</head>

<body class="bg-slate-50">

    <div class="flex flex-col md:flex-row min-h-screen">

        <aside class="w-full md:w-72 bg-white shadow-2xl p-6 flex flex-col border-r border-slate-200 z-50">
            <div class="mb-8 text-center">
                <h1 class="text-3xl font-black text-primary italic tracking-tighter uppercase">Zmply <span
                        class="text-secondary">Helper</span></h1>
                <div class="badge badge-outline badge-xs opacity-50 font-bold">To Increase your Productivity</div>
            </div>

            <div id="user-profile-area" class="bg-slate-100 rounded-2xl p-4 mb-6 text-center border border-slate-200">
                <div class="avatar placeholder mb-2">
                    <div class="bg-neutral text-neutral-content rounded-full w-12 text-xl font-bold"><span>U</span>
                    </div>
                </div>
                <h3 class="font-bold text-sm">Guest User</h3>
                <button id="google-login-btn" class="btn btn-xs btn-primary w-full text-white mt-2 font-black">Login
                    with Google</button>
            </div>

            <nav class="flex-1 overflow-y-auto">
                <ul class="menu p-0 gap-2">
                    <li><button id="btn-task" onclick="switchTab('task')"
                            class="nav-btn p-4 rounded-2xl font-bold bg-primary text-white w-full text-left">üìã Zmply
                            Task
                            Tracker</button></li>
                    <li><button id="btn-notes" onclick="switchTab('notes')"
                            class="nav-btn p-4 rounded-2xl font-bold text-slate-600 w-full text-left">üìù Zmply
                            Notes</button></li>
                    <li><button id="btn-reminders" onclick="switchTab('reminders')"
                            class="nav-btn p-4 rounded-2xl font-bold text-slate-600 w-full text-left">üîî Zmply
                            Reminders</button></li>
                    <li><button id="btn-pricing" onclick="switchTab('pricing')"
                            class="nav-btn p-4 rounded-2xl font-bold text-warning italic w-full text-left">‚≠ê PRO
                            Features</button></li>
                </ul>
            </nav>

            <div class="ad-slot h-40 rounded-2xl mt-6 mb-4">ADVERTISEMENT<br>(300 x 250)</div>

            <div class="text-[10px] font-bold opacity-30 flex justify-around border-t pt-4">
                <a href="#" class="hover:underline">Privacy</a>
                <a href="#" class="hover:underline">Terms</a>
                <a href="#" class="hover:underline">Support</a>
            </div>
        </aside>

        <main class="flex-1 p-6 lg:p-12">

            <div class="ad-slot w-full h-20 rounded-2xl mb-8">TOP BANNER AD (Responsive AdSense Slot)</div>

            <section id="app-pricing" class="tab-content">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="text-4xl font-black text-slate-800 mb-4 tracking-tight">Scale Your Productivity</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-10">
                        <div class="card bg-white border-2 border-slate-200 p-8 shadow-sm">
                            <h3 class="text-xl font-bold mb-2">Basic</h3>
                            <div class="text-4xl font-black mb-6">$0</div>
                            <ul class="text-left space-y-3 mb-8 text-sm">
                                <li>‚úÖ Local Storage</li>
                                <li>‚úÖ Basic Tasks & Notes</li>
                                <li class="text-slate-300">‚ùå WhatsApp Alerts</li>
                            </ul>
                            <button class="btn btn-outline btn-disabled">Current Plan</button>
                        </div>
                        <div class="card bg-white border-4 border-primary p-8 shadow-2xl relative">
                            <div class="badge badge-primary absolute -top-3 right-5 font-bold">BEST VALUE</div>
                            <h3 class="text-xl font-bold mb-2 text-primary">Pro Business</h3>
                            <div class="text-4xl font-black mb-6">$4.99</div>
                            <ul class="text-left space-y-3 mb-8 text-sm">
                                <li>üìù <b>Sub Tasks:</b> Add Sub tasks</li>
                                <li>üöÄ <b>Cloud Sync:</b> Access anywhere</li>
                                <li>üì± <b>WhatsApp Alerts:</b> Direct to phone</li>
                                <li>üö´ <b>Zero Ads:</b> Clean experience</li>
                            </ul>
                            <button class="btn btn-primary text-white font-bold">GET PRO NOW</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="app-task" class="tab-content active">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div
                        class="lg:col-span-1 bg-white p-6 rounded-3xl shadow-sm border border-slate-200 flex flex-col items-center justify-center">
                        <h2 class="text-sm font-black text-slate-400 uppercase tracking-widest mb-1">Task Progress</h2>
                        <div style="width: 220px; height: 110px;">
                            <canvas id="taskProgressChart"></canvas>
                        </div>
                    </div>

                    <div
                        class="lg:col-span-2 bg-white p-6 rounded-3xl shadow-sm border border-slate-200 flex flex-col justify-center">
                        <h2 class="text-xl font-black text-slate-800 mb-4 uppercase text-center">ZMPLY Task Tracker</h2>
                        <div class="flex flex-col gap-3">
                            <input type="text" id="taskTitle" placeholder="What needs to be done?"
                                class="input input-bordered w-full font-bold" />
                            <div id="task-editor-container"
                                class="bg-slate-50 rounded-xl border border-slate-200 overflow-hidden">
                                <div id="task-desc-editor" style="height: 80px;"></div>
                            </div>
                            <button onclick="addTask()" class="btn btn-primary font-black text-white">ADD TASK</button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div>
                        <h3
                            class="font-black mb-4 flex items-center gap-2 text-error uppercase text-sm tracking-widest px-2">
                            <span>üî¥</span> To-Do
                        </h3>
                        <div id="todo" class="column flex flex-col gap-4"></div>
                    </div>
                    <div>
                        <h3
                            class="font-black mb-4 flex items-center gap-2 text-warning uppercase text-sm tracking-widest px-2">
                            <span>üü°</span> In Progress
                        </h3>
                        <div id="in-progress" class="column flex flex-col gap-4"></div>
                    </div>
                    <div>
                        <h3
                            class="font-black mb-4 flex items-center gap-2 text-success uppercase text-sm tracking-widest px-2">
                            <span>üü¢</span> Completed
                        </h3>
                        <div id="completed" class="column flex flex-col gap-4"></div>
                    </div>
                </div>
            </section>

            <section id="app-notes" class="tab-content">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-black text-slate-800">Zmply Notes</h2>
                    <button onclick="saveNote()" class="btn btn-secondary text-white font-bold px-8">SAVE
                        NOTE</button>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                    <div class="lg:col-span-3">
                        <input type="text" id="noteTitle" placeholder="Note Title..."
                            class="input input-bordered w-full mb-4 font-bold text-lg" />
                        <div id="editor-container"></div>
                    </div>
                    <div class="lg:col-span-1">
                        <h3 class="font-black mb-4 opacity-50 text-sm uppercase">Saved Notes</h3>
                        <div id="notes-list" class="flex flex-col gap-3"></div>
                    </div>
                </div>
            </section>

            <section id="app-reminders" class="tab-content">
                <h2 class="text-3xl font-black text-slate-800 mb-8">Reminders</h2>
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input type="text" id="remTitle" placeholder="Meeting Title"
                            class="input input-bordered w-full font-bold" />
                        <div class="flex gap-2">
                            <input type="date" id="remDate" class="input input-bordered w-full" />
                            <input type="time" id="remTime" class="input input-bordered w-full" />
                        </div>
                    </div>
                    <textarea id="remDesc" placeholder="Description (Optional)"
                        class="textarea textarea-bordered w-full mb-4 font-medium" rows="2"></textarea>

                    <div class="bg-slate-50 p-4 rounded-2xl mb-4 text-sm font-bold">
                        Remind me before:
                        <select id="remOffset" class="select select-bordered select-sm ml-2">
                            <option value="15">15 Minutes</option>
                            <option value="30">30 Minutes</option>
                            <option value="60">1 Hour</option>
                        </select>
                    </div>
                    <button id="rem-submit-btn" onclick="addReminder()"
                        class="btn btn-accent w-full font-black text-white">SET REMINDER</button>
                </div>
                <div id="reminders-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </section>

            <section id="app-pricing" class="tab-content">
                <h2 class="text-3xl font-black text-slate-800 mb-8">Pricing coming here...</h2>
            </section>
        </main>
    </div>

    <script>

        const db = new Dexie("ZmplyProDB");
        db.version(2).stores({
            tasks: '++id, title, description, status, subTasks',
            notes: '++id, title, content, date',
            reminders: '++id, title, remindTime, status'
        }); let quill;

        // --- TAB SYSTEM ---
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(s => s.classList.remove('active'));
            document.getElementById('app-' + tab).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('bg-primary', 'text-white'); b.classList.add('text-slate-600'); });
            const activeBtn = document.getElementById('btn-' + tab);
            if (activeBtn) { activeBtn.classList.remove('text-slate-600'); activeBtn.classList.add('bg-primary', 'text-white'); }
            if (tab === 'notes' && !quill) initQuill();
            if (tab === 'notes') renderNotes();
            if (tab === 'task') renderTasks();
            if (tab === 'reminders') renderReminders();
        }

        function initQuill() { quill = new Quill('#editor-container', { theme: 'snow', modules: { toolbar: [[{ header: [1, 2, false] }], ['bold', 'italic', 'underline'], [{ list: 'ordered' }, { list: 'bullet' }], ['clean']] } }); }


        // --- TASK SYSTEM ---
        async function addTask() {
            const t = document.getElementById('taskTitle').value;
            // Description eka gannawa, eth eka thiyena eka aniwarya naha
            const d = taskEditor.root.innerHTML === '<p><br></p>' ? '' : taskEditor.root.innerHTML;

            if (!t) {
                Swal.fire('Error', 'Please enter a Task Name', 'error');
                return;
            }

            await db.tasks.add({
                title: t,
                description: d,
                status: 'todo',
                subTasks: []
            });

            // Reset fields
            document.getElementById('taskTitle').value = '';
            taskEditor.setContents([]);
            renderTasks();
        }

        // 1. Drag & Drop initialize karana kalla wenama function ekakata gaththa
        function initSortable() {
            ['todo', 'in-progress', 'completed'].forEach(id => {
                const el = document.getElementById(id);
                const existingInstance = Sortable.get(el);
                if (existingInstance) existingInstance.destroy();

                new Sortable(el, {
                    group: 'tasks',
                    animation: 250,
                    draggable: '.sticky-note',
                    onEnd: async (e) => {
                        const taskId = parseInt(e.item.dataset.id);
                        const newStatus = e.to.id;

                        if (newStatus === 'completed') {
                            const task = await db.tasks.get(taskId);

                            // Requirement: Sub-tasks thiyenawa nam witharak check karanna
                            const hasSubTasks = task.subTasks && task.subTasks.length > 0;

                            if (hasSubTasks) {
                                const allSubTasksDone = task.subTasks.every(st => st.completed);

                                if (!allSubTasksDone) {
                                    Swal.fire({
                                        icon: 'warning',
                                        title: 'Action Blocked',
                                        text: 'This task has sub-tasks. Please complete ALL of them before moving to Completed!',
                                        confirmButtonColor: '#f87272'
                                    });
                                    renderTasks(); // Reverse the move
                                    return;
                                }
                            }
                            // Sub-tasks naththan awulak na, kelinma completed ekata yanawa
                        }
                        await db.tasks.update(taskId, { status: newStatus });
                        renderTasks();
                    }
                });
            });
        }

        async function renderTasks() {
            const all = await db.tasks.toArray();

            ['todo', 'in-progress', 'completed'].forEach(status => {
                const col = document.getElementById(status);
                col.innerHTML = '';
                const filtered = all.filter(t => t.status === status);

                if (filtered.length === 0) {
                    col.innerHTML = `<div class="placeholder-card"><span>NO TASKS HERE</span></div>`;
                } else {
                    filtered.forEach(task => {
                        const isEditable = task.status !== 'completed';
                        const canCheckSubTask = task.status === 'in-progress';

                        const card = document.createElement('div');
                        card.dataset.id = task.id;
                        card.className = `sticky-note bg-white p-5 rounded-2xl shadow-sm border-t-4 mb-4 flex flex-col h-auto w-full overflow-hidden transition-all hover:shadow-md ${status === 'todo' ? 'border-error' : status === 'in-progress' ? 'border-warning' : 'border-success'}`;

                        let subTaskUI = `
    <div class="mt-4 space-y-2 border-t border-slate-50 pt-3">
        ${(task.subTasks || []).map((st, i) => {
                            // Logic: Todo wala check karanna ba, Completed wala uncheck karanna ba
                            const isTodo = task.status === 'todo';
                            const isDone = task.status === 'completed';
                            const checkboxDisabled = isTodo || isDone;

                            return `
            <div class="group flex items-center gap-2 text-[11px] font-bold bg-slate-50/80 p-2 rounded-lg border border-slate-100">
                <input type="checkbox" 
                    ${st.completed ? 'checked' : ''} 
                    ${checkboxDisabled ? 'disabled' : ''} 
                    onchange="toggleSubTask(${task.id}, ${i})" 
                    class="checkbox checkbox-xs checkbox-primary ${checkboxDisabled ? 'opacity-30 cursor-not-allowed' : ''}">
                
                <span contenteditable="${isEditable}" 
                      onblur="updateSubTaskText(${task.id}, ${i}, this.innerText)" 
                      class="${st.completed ? 'line-through text-black font-black opacity-100' : 'text-slate-600'} outline-none break-all w-full h-auto">
                      ${st.text}
                </span>
                ${!isDone ? `<button onclick="deleteSubTask(${task.id}, ${i})" class="text-slate-300 hover:text-error opacity-0 group-hover:opacity-100 transition-all font-bold px-1">√ó</button>` : ''}
            </div>`;
                        }).join('')}
        ${isEditable ? `
        <div class="flex gap-1 mt-2">
            <input type="text" id="input-${task.id}" class="input input-xs input-bordered w-full font-bold h-8 text-[11px]" placeholder="Add sub-task...">
            <button onclick="addSubTask(${task.id})" class="btn btn-xs btn-primary font-black h-8">+</button>
        </div>` : ''}
    </div>`;

                        card.innerHTML = `
    <div class="flex justify-between items-start gap-3 w-full">
        <div class="drag-handle cursor-grab active:cursor-grabbing text-slate-300 hover:text-slate-500 mt-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="5" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="19" r="1"/></svg>
        </div>

        <div class="flex-1 min-w-0 h-auto">
            <div contenteditable="${isEditable}" onblur="updateTaskText(${task.id}, 'title', this.innerText)" 
                 class="font-black text-slate-900 outline-none break-words text-[15px] leading-tight p-1 rounded-md w-full h-auto">
                 ${task.title}
            </div>
            
            <div class="mt-3 ml-1 pl-3 border-l-2 border-slate-200 h-auto">
                <div id="desc-editor-${task.id}" class="text-[12px] text-slate-500 font-medium w-full" 
                     style="min-height: 20px; height: auto;">
                     ${task.description || ''}
                </div>
            </div>
        </div>
        
        <button onclick="deleteTask(${task.id})" class="text-error font-bold hover:scale-125 transition-transform text-xl px-1">√ó</button>
    </div>
    ${subTaskUI}`;

                        col.appendChild(card);

                        // Initialize Quill editor for each description
                        if (isEditable) {
                            const quill = new Quill(`#desc-editor-${task.id}`, {
                                theme: 'snow',
                                modules: { toolbar: false }
                            });
                            quill.on('text-change', () => {
                                updateTaskText(task.id, 'description', quill.root.innerHTML);
                            });
                        }
                    });
                }
            });
            updateChart();
            initSortable();
        }

        let taskChart = null;

        async function updateChart() {
            const all = await db.tasks.toArray();
            const counts = {
                todo: all.filter(t => t.status === 'todo').length,
                progress: all.filter(t => t.status === 'in-progress').length,
                done: all.filter(t => t.status === 'completed').length
            };
            const total = all.length;
            const getP = (v) => total > 0 ? Math.round((v / total) * 100) : 0;

            const ctx = document.getElementById('taskProgressChart').getContext('2d');
            if (taskChart) taskChart.destroy();

            taskChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [counts.todo, counts.progress, counts.done],
                        backgroundColor: ['#ff5861', '#fbbd23', '#00a96e'],
                        borderWidth: 0,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%', // Poddak chart eka nihada kala labels walata ida ganna
                    plugins: {
                        tooltip: { enabled: true },
                        legend: { display: false }
                    }
                },
                plugins: [{
                    id: 'textInside',
                    afterDraw: (chart) => {
                        const { ctx, width, height } = chart;
                        ctx.save();
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';

                        // 1. Arc eka athule thiyena percentages (To-Do, In Progress etc.)
                        ctx.font = 'bold 9px sans-serif';
                        ctx.fillStyle = '#fff';
                        const dataset = chart.getDatasetMeta(0);
                        dataset.data.forEach((arc, i) => {
                            const val = chart.data.datasets[0].data[i];
                            if (val > 0) {
                                const { x, y } = arc.tooltipPosition();
                                ctx.fillText(getP(val) + '%', x, y);
                            }
                        });

                        // 2. Meda thiyena Loku Percentage eka (Completed %)
                        // Meke height eka poddak udaata gaththa (height - 45)
                        ctx.font = 'bold 28px Inter, sans-serif';
                        ctx.fillStyle = '#1e293b';
                        ctx.fillText(getP(counts.done) + '%', width / 2, height - 30);

                        // 3. "COMPLETED" kiyana Label eka
                        // Spacing wadi kala (height - 18) saha kapenne nathi wenna adjustment kala
                        ctx.font = 'bold 11px Inter, sans-serif';
                        ctx.fillStyle = '#94a3b8';
                        ctx.letterSpacing = "1px";
                        ctx.fillText('COMPLETED', width / 2, height - 5);

                        ctx.restore();
                    }
                }]
            });
        }

        async function updateTaskText(id, field, value) {
            const updateData = {};
            updateData[field] = value;
            await db.tasks.update(id, updateData);
        }

        async function updateSubTaskText(taskId, index, newText) {
            const task = await db.tasks.get(taskId);
            task.subTasks[index].text = newText;
            await db.tasks.put(task);
        }

        async function addSubTask(taskId) {
            const input = document.getElementById(`input-${taskId}`);
            if (!input.value) return;
            const task = await db.tasks.get(taskId);
            task.subTasks.push({ text: input.value, completed: false });
            await db.tasks.put(task);
            renderTasks();
        }

        async function toggleSubTask(taskId, index) {
            const task = await db.tasks.get(taskId);
            task.subTasks[index].completed = !task.subTasks[index].completed;
            await db.tasks.put(task);
            renderTasks();
        }
        async function deleteSubTask(tid, index) {
            const task = await db.tasks.get(tid);
            if (task && task.subTasks) {
                task.subTasks.splice(index, 1); // Eka sub-task ekak witharak ain karanawa
                await db.tasks.put(task);
                renderTasks(); // Board eka refresh karanawa
            }
        }
        async function deleteTask(id) { await db.tasks.delete(id); renderTasks(); }

        let taskEditor;
        function initTaskEditor() {
            if (!taskEditor) {
                taskEditor = new Quill('#task-desc-editor', {
                    theme: 'snow',
                    placeholder: 'Write your description here...',
                    modules: {
                        toolbar: [
                            ['bold', 'italic', 'underline'],
                            [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                            ['clean']
                        ]
                    }
                });
            }
        }
        // Page ‡∂ë‡∂ö load ‡∑Ä‡∑ô‡∂Ø‡∑ä‡∂Ø‡∑ì‡∂∏ ‡∂∏‡∑ö‡∂ö call ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
        document.addEventListener('DOMContentLoaded', initTaskEditor);

        document.addEventListener('DOMContentLoaded', renderTasks);

        // --- NOTES ---
        async function saveNote() { const title = document.getElementById('noteTitle').value; if (!title) return; await db.notes.add({ title, content: quill.root.innerHTML, date: new Date().toLocaleString() }); document.getElementById('noteTitle').value = ''; quill.setContents([]); renderNotes(); }
        async function renderNotes() { const notes = await db.notes.reverse().toArray(); const list = document.getElementById('notes-list'); list.innerHTML = ''; notes.forEach(n => { const d = document.createElement('div'); d.className = "bg-white p-3 rounded-xl shadow-sm border border-slate-200 cursor-pointer text-sm font-bold flex justify-between"; d.innerHTML = `<span onclick="loadNote(${n.id})">${n.title}</span> <button onclick="deleteNote(${n.id})" class="text-error">√ó</button>`; list.appendChild(d); }); }
        async function loadNote(id) { const n = await db.notes.get(id); document.getElementById('noteTitle').value = n.title; quill.root.innerHTML = n.content; }
        async function deleteNote(id) { await db.notes.delete(id); renderNotes(); }

        // --- REMINDERS ---
        // 1. Add Reminder (Supports Description)
        async function addReminder() {
            const title = document.getElementById('remTitle').value;
            const desc = document.getElementById('remDesc').value;
            const date = document.getElementById('remDate').value;
            const time = document.getElementById('remTime').value;
            const offset = parseInt(document.getElementById('remOffset').value);

            if (!title || !date || !time) {
                Swal.fire('Error', 'Please fill in Title, Date, and Time', 'error');
                return;
            }

            const mTime = new Date(`${date}T${time}`).getTime();
            const rTime = mTime - (offset * 60000);

            await db.reminders.add({
                title,
                description: desc,
                meetingTime: mTime,
                remindTime: rTime,
                status: 'pending',
                offset: offset // For editing purpose
            });

            // Reset fields
            document.getElementById('remTitle').value = '';
            document.getElementById('remDesc').value = '';
            renderReminders();
        }

        // 2. Render Reminders (With Edit, Delete, and Description)
        async function renderReminders() {
            // 1. Database ‡∂ë‡∂ö‡∑ô‡∂±‡∑ä reminders ‡∂î‡∂ö‡∑ä‡∂ö‡∑ú‡∂∏ ‡∂ú‡∂±‡∑ä‡∂±‡∑Ä‡∑è
            const items = await db.reminders.toArray();
            const list = document.getElementById('reminders-list');
            list.innerHTML = '';

            // 2. Sorting Logic ‡∂ë‡∂ö (Date > Time > Added Order)
            items.sort((a, b) => {
                // ‡∂¥‡∑Ö‡∑Ä‡∑ô‡∂±‡∑í ‡∂¥‡∑í‡∂∫‡∑Ä‡∂ª: Meeting Time (Date + Time) ‡∂ë‡∂ö ‡∑É‡∑ê‡∑É‡∂≥‡∑ì‡∂∏
                if (a.meetingTime !== b.meetingTime) {
                    return a.meetingTime - b.meetingTime; // ‡∂Ö‡∂©‡∑î ‡∑Ä‡∑ô‡∂Ω‡∑è‡∑Ä/‡∂Ø‡∑í‡∂±‡∂∫ ‡∂≠‡∑í‡∂∫‡∑ô‡∂± ‡∂ë‡∂ö ‡∂∏‡∑î‡∂Ω‡∂ß ‡∂ë‡∂±‡∑Ä‡∑è
                }

                // ‡∂Ø‡∑ô‡∑Ä‡∑ê‡∂±‡∑í ‡∂¥‡∑í‡∂∫‡∑Ä‡∂ª: ‡∑Ä‡∑ô‡∂Ω‡∑è‡∑Ä‡∂≠‡∑ä ‡∑É‡∂∏‡∑è‡∂± ‡∂±‡∂∏‡∑ä, ‡∂â‡∑É‡∑ä‡∑É‡∑ô‡∂Ω‡∑ä‡∂Ω‡∑è‡∂∏ add ‡∂ö‡∂ª‡∂¥‡∑î ‡∂ë‡∂ö (ID ‡∂ë‡∂ö ‡∂Ö‡∂±‡∑î‡∑Ä) ‡∂∏‡∑î‡∂Ω‡∂ß ‡∂Ø‡∑è‡∂±‡∑Ä‡∑è
                return a.id - b.id;
            });

            // 3. ‡∂¥‡∑í‡∑Ö‡∑í‡∑Ä‡∑ô‡∑Ö ‡∂ö‡∂ª‡∂¥‡∑î ‡∂Ω‡∑ê‡∂∫‡∑í‡∑É‡∑ä‡∂≠‡∑î‡∑Ä Render ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
            items.forEach(rem => {
                const d = document.createElement('div');
                const isDone = rem.status === 'done';

                d.className = `card bg-white p-5 shadow-sm border-l-4 transition-all hover:shadow-md ${isDone ? 'border-success opacity-70' : 'border-accent'}`;

                d.innerHTML = `
            <div class="flex justify-between items-start mb-2">
                <div class="flex-1 min-w-0">
                    <h3 class="font-black text-slate-800 leading-tight break-words">${rem.title}</h3>
                </div>
                <div class="flex gap-1 ml-2">
                    ${!isDone ? `<button onclick="editReminder(${rem.id})" class="text-slate-400 hover:text-primary text-xs font-bold">EDIT</button>` : ''}
                    <button onclick="deleteReminder(${rem.id})" class="text-slate-300 hover:text-error text-lg leading-none ml-1">√ó</button>
                </div>
            </div>
            
            ${rem.description ? `<p class="text-[12px] text-slate-500 mb-3 break-words">${rem.description}</p>` : ''}
            
            <div class="flex items-center gap-2 mt-auto pt-3 border-t border-slate-50">
                <span class="text-[10px] font-black bg-slate-100 px-2 py-1 rounded text-slate-500">
                    üìÖ ${new Date(rem.meetingTime).toLocaleString([], { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}
                </span>
                ${isDone ? '<span class="badge badge-success badge-xs font-bold text-[9px] text-white">NOTIFIED</span>' : ''}
            </div>
        `;
                list.appendChild(d);
            });
        }

        // 3. Delete Reminder
        async function deleteReminder(id) {
            const result = await Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#f87272',
                confirmButtonText: 'Yes, delete it!'
            });

            if (result.isConfirmed) {
                await db.reminders.delete(id);
                renderReminders();
            }
        }

        // 4. Edit Reminder (Loads data back to form)
        async function editReminder(id) {
            const rem = await db.reminders.get(id);
            if (!rem) return;

            // Load to form
            document.getElementById('remTitle').value = rem.title;
            document.getElementById('remDesc').value = rem.description || '';

            const dt = new Date(rem.meetingTime);
            document.getElementById('remDate').value = dt.toISOString().split('T')[0];
            document.getElementById('remTime').value = dt.toTimeString().slice(0, 5);
            document.getElementById('remOffset').value = rem.offset || "15";

            // Delete the old one so the user can re-save (or you can update the logic to update existing)
            // For simplicity in this suite, we'll let them save as a new or update. 
            // Let's change the button to "UPDATE" temporarily:
            const btn = document.getElementById('rem-submit-btn');
            btn.innerText = "UPDATE & SAVE";
            btn.onclick = async () => {
                await db.reminders.delete(id); // Remove old version
                await addReminder(); // Add new version
                btn.innerText = "SET REMINDER";
                btn.onclick = addReminder;
            };

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        // --- NOTIFICATIONS ---
        if (Notification.permission !== "granted") Notification.requestPermission();
        setInterval(async () => { const now = Date.now(); const pending = await db.reminders.where('status').equals('pending').toArray(); pending.forEach(async (rem) => { if (now >= rem.remindTime) { await db.reminders.update(rem.id, { status: 'done' }); if (Notification.permission === "granted") new Notification("üîî ZMPLY REMINDER", { body: rem.title }); Swal.fire({ title: 'Reminder!', text: rem.title, icon: 'info' }); renderReminders(); } }); }, 5000);

        document.addEventListener('DOMContentLoaded', () => switchTab('task'));

    </script>

    <script src="config.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // window.firebaseConfig thiyeda kiyala check karala initialize karanna
        if (window.firebaseConfig) {
            const app = initializeApp(window.firebaseConfig);
            const auth = getAuth(app);
            const provider = new GoogleAuthProvider();

            window.loginWithGoogle = () => {
                signInWithPopup(auth, provider).catch(e => console.error(e));
            };

            window.logoutUser = () => { signOut(auth); };

            onAuthStateChanged(auth, (user) => {
                const userArea = document.getElementById('user-profile-area');
                if (user) {
                    userArea.innerHTML = `
                    <div class="avatar online mb-2"><div class="w-12 rounded-full border-2 border-primary"><img src="${user.photoURL}" /></div></div>
                    <h3 class="font-bold text-sm">${user.displayName}</h3>
                    <p class="text-[9px] text-primary font-black mb-2 uppercase">PRO MEMBER</p>
                    <button onclick="logoutUser()" class="btn btn-xs btn-outline btn-error w-full">Logout</button>
                `;
                } else {
                    userArea.innerHTML = `
                    <div class="avatar placeholder mb-2"><div class="bg-neutral text-neutral-content rounded-full w-12 text-xl font-bold"><span>U</span></div></div>
                    <h3 class="font-bold text-sm text-slate-400 italic">Guest Mode</h3>
                    <button onclick="loginWithGoogle()" class="btn btn-xs btn-primary w-full text-white mt-2 font-black">Login with Google</button>
                `;
                }
                if (typeof renderTasks === "function") renderTasks();
            });
        } else {
            console.error("Firebase configuration missing! Check config.js loading.");
        }
    </script>
</body>

</html>